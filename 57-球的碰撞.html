<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="./modernizr-1.6.min.js"></script>
  </head>
  <body>
    <div style="position: absolute; top: 50px; left: 50px">
      <canvas id="canvasOne" width="500" height="500">
        Your browser does not support HTML5 Canvas
      </canvas>
      <form action="">
        Canvas Width:
        <input
          type="range"
          id="canvasWidth"
          min="0"
          max="1000"
          step="1"
          value="500"
        />
        <br />
        Canvas Height:
        <input
          type="range"
          id="canvasHeight"
          min="0"
          max="1000"
          step="1"
          value="500"
        />
      </form>
    </div>
    <script>
      window.addEventListener("load", eventWindowLoaded, false);
      var Debugger = function () {};
      Debugger.log = function (message) {
        try {
          console.log(message);
        } catch (exception) {
          return;
        }
      };

      function eventWindowLoaded() {
        canvasApp();
      }

      function canvasSupport() {
        return Modernizr.canvas;
      }

      function canvasApp() {
        if (!canvasSupport()) {
          return;
        }

        formElement = document.getElementById("canvasWidth");
        formElement.addEventListener("change", canvasWidthChanged, false);

        formElement = document.getElementById("canvasHeight");
        formElement.addEventListener("change", canvasHeightChanged, false);

        function drawScreen() {
          context.fillStyle = "#EEEEEE";
          context.fillRect(0, 0, theCanvas.width, theCanvas.height);
          //方形
          context.strokeStyle = "#000000";
          context.strokeRect(1, 1, theCanvas.width - 2, theCanvas.height - 2);

          update();
          testWalls();
          collide();
          render();
        }

        function update() {
          for (var i = 0; i < balls.length; i++) {
            ball = balls[i];
            ball.nextx = ball.x += ball.velocityx;
            ball.nexty = ball.y += ball.velocityy;
          }
        }

        function testWalls() {
          var ball;
          var testBall;
          for (var i = 0; i < balls.length; i++) {
            ball = balls[i];
            if (ball.nextx + ball.radius > theCanvas.width) {
              ball.velocityx = ball.velocityx * -1;
              ball.nextx = theCanvas.width - ball.radius;
            } else if (ball.nextx - ball.radius < 0) {
              ball.velocityx = ball.velocityx * -1;
              ball.nextx = ball.radius;
            } else if (ball.nexty + ball.radius > theCanvas.height) {
              ball.velocityy = ball.velocityy * -1;
              ball.nexty = theCanvas.height - ball.radius;
            } else if (ball.nexty - ball.radius < 0) {
              ball.velocityy = ball.velocityy * -1;
              ball.nexty = ball.radius;
            }
          }
        }

        function render() {
          var ball;
          context.fillStyle = "#000000";
          for (var i = 0; i < balls.length; i++) {
            ball = balls[i];
            ball.x = ball.nextx;
            ball.y = ball.nexty;

            context.beginPath();
            context.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2, true);
          }
        }

        function collide() {
          var ball;
          var testBall;
          for (var i = 0; i < balls.length; i++) {
            ball = balls[i];
            for (var j = i + 1; j < balls.length; j++) {
              testBall = balls[j];
              if (hitTestCircle(ball, testBall)) {
                collideBalls(ball, testBall);
              }
            }
          }
        }

        function hitTestCircle(ball1, ball2) {
          var retval = false;
          var dx = ball1.nextx - ball2.nextx;
          var dy = ball1.nexty - ball2.nexty;
          var distance = dx * dx + dy * dy;
          if (
            distance <=
            (ball1.radius + ball2.radius) * (ball1.radius + ball2.radius)
          ) {
            retval = true;
          }
        }

        function collideBalls(ball1, ball2){
            
        }

        var numBalls = 999;
        var maxSize = 8;
        var minSize = 5;
        var maxSpeed = maxSize + 5;
        var balls = new Array();
        var tempBall;
        var tempX;
        var tempY;
        var tempSpeed;
        var tempAngle;
        var tempRadius;
        var tempRadians;
        var tempXunits;
        var tempYunits;

        theCanvas = document.getElementById("canvasOne");
        context = theCanvas.getContext("2d");

        for (var i = 0; i < numBalls; i++) {
          tempRadius = Math.floor(Math.random() * maxSize) + minSize;
          tempX =
            tempRadius * 2 +
            Math.floor(Math.random() * theCanvas.width) -
            tempRadius * 2;
          tempY =
            tempRadius * 2 +
            Math.floor(Math.random() * theCanvas.height) -
            tempRadius * 2;
          tempSpeed = maxSpeed - tempRadius;
          tempAngle = Math.floor(Math.random() * 360);
          tempXunits = Math.cos(rads(tempAngle)) * tempSpeed;
          tempYunits = Math.sin(rads(tempAngle)) * tempSpeed;
          tempBall = {
            x: tempX,
            y: tempY,
            radius: tempRadius,
            speed: tempSpeed,
            angle: tempAngle,
            xunits: tempXunits,
            yunits: tempYunits,
          };
          balls.push(tempBall);
        }

        setInterval(drawScreen, 33);

        function canvasWidthChanged(e) {
          var target = e.target;
          theCanvas.width = target.value;
          drawScreen();
        }

        function canvasHeightChanged(e) {
          var target = e.target;
          theCanvas.height = target.value;
          drawScreen();
        }

        function rads(x) {
          return (Math.PI * x) / 180;
        }
      }
    </script>
  </body>
</html>
